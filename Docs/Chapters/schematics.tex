\section{Schematy funkcjonalne układu.}

\subsection{Schemat blokowy analizatora.}
Analizator stanów logicznych składa się z 3 głównych bloków:
\begin{enumerate}
    \item Układu wejściowego\\
Układ wejściowy analizatora zapewnia dostęp do 16 wejść cyfrowych,
2 szybkich wejść analogowych niskiej rozdzielczości, 2 wolnych wejść
analogowych dużej rozdzielczości oraz 4 złącz masy. Szczegółowy opis 
interfejsu wejściowego analizatora przedstawiono poniżej.
\input{Img/input.tex}

Opis wyprowadzeń interfejsu:
\begin{enumerate}
    \item 0 - 15 - wejścia cyfrowe
    \item TRIG0, TRIG1 - wejście sygnału wyzwalającego
    \item ADC0, ADC1 - szybkie wejścia analogowe małej rozdzielczości
    \item ADC2, ADC3 - wolne wejścia analogowe dużej rozdzielczości
    \item GND - masa układu 
\end{enumerate} 

    \item Mikrokontrolera(Raspberry Pi Pico RP2040)
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.6\textwidth]{rp2040_block_diagram.png}
        \caption{RP2040}
        \label{fig:RP2040}
    \end{figure}

    \item Przetwornika analogowo-cyfrowego 
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.6\textwidth]{ADC_block_diagram.png}
        \caption{ADS1115}
        \label{fig:ADS1115}
    \end{figure}

Schemat blokowy analizatora przedstawiono poniżej.
\input{Img/block_diagram.tex}
\end{enumerate}

\useNormalLandscape{}
\subsection{Schemat ideowy analizatora}
    \begin{figure}[!ht]
        \centering
        \includegraphics[width = 0.9\textwidth]{schematic.jpg}
        \caption{Schemat ideowy analizatora stanów logicznych}
    \end{figure}
\usePortrait{}

    W schemacie aplikacji do zabezpiecznia stopnia wejściowego analizatora dodano możliwość wlutowania rezystora ograniczająceg
    prąd wejściowy oraz zastosowano szybkie diody Zenera na 3.6V chroniąc go przed przepięciam napięciowymi. Układ taki działa
    również jako dolnoprzepustowy filtr RC, a z uwagi na małą pojemność diody ($400pF$), może tłumić on sygnały cyfrowe w paśmie
    pracy analizatora.
    $f_{3\mathrm{dB}} = \frac{1}{2\pi RC}$. 
    Z kolei dla stabilnej pracy LDO oraz filtracji zakłóceń wysokoczęstotliwościowych, oprócz rekomendacji
    noty katalogowej, dodano po 3 kondensatory decaplingujące ($3.3uF$) na wejście oraz wyjście układu. Dodano także
    przycisk monostabilny RESET z kondensatorem (tzw. debouncer) podłaczony do pinu RUN Pi Pico i masy.




\subsection{Opis płytki PCB}

    Płytka PCB analizatora stanów logicznych o wymiarach 74.3mm x 59mm została zaprojektowana w oprogramowaniu Altium Designer.
    Do poprowadzenia sygnałów miedzy blokami funkcyjnymi wykorzystano ścieżki na warstwie 1 i 4 o szerokości 10mil (0.254mm)
    oraz przelotki o wymiarach 0.3mm/0.6mm (otwór/średnica padu). 
    W celu zapewnienia jednoczesnego próbkowania sygnałów wejściowych w analizatorze stanów logicznych, starano zachować się
    jednakowe długości ścieżek sygnałowych prowadzących do wejść mikrokontrolera wykorzystując tzw. meandrowanie.
    Podejście takie było uwarunkowane tym, że różnice długości ścieżek sygnałowych prowadzą do zmian w czasie propagacji
    sygnału, co może powodować błędne rozpoznanie stanów logicznych lub zakłócenia synchronizacji danych. Zmontowane PCB
    wraz z przed przedstawiono na rysunku \ref{fig:PCB}. Dla układu zaprjektowano też specjalne podstawki chroniące przded zwarciem
    poprzez położenie na metalowych elemetnach.
    
\begin{figure}[H]
        \centering
        \includegraphics[width = 0.8\textwidth]{PCB.jpg}
        \caption{Widok zmontowanego PCB}
        \label{fig:PCB}
    \end{figure}

    \begin{figure}[H]
        \centering
        \includegraphics[width = 0.5\textwidth]{podstawka.jpg}
        \caption{Podstawka z druku 3D}
        \label{fig:podstawka}
    \end{figure}
    
    
\subsection{Stackup}
    Na rysunku \ref{fig:stackup} przedstawiono wybrany stackup PCB proponowany przez firmę JLC PCB do projektów 4-o warstwowych.
    Zaletą jego stosowania jest GND na 2 oraz 3 warstwie poprawiajaca ciągłość masy ukałdu oraz skracająca pętle
    prądów powrotnych. Dodatkowo, taki wybór stackaup ogranicza przesłuchy i odbicia pomiędzy dolną i górną warstwą sygnałową
    czyniąc go dobrym wyborem dla naszej aplikacji. Widok w formacie gerber warsty 1 oraz 4 przedstawiono
    na rysunku \ref{fig:gerber_top} i \ref{fig:gerber_bottom}. 
    \begin{figure}[H]
        \centering
        \includegraphics[width = 0.8\textwidth]{stackup.png}
        \caption{Stackup zalecany przez firmę JLC PCB}
        \label{fig:stackup}
    \end{figure}

    \begin{figure}[H]
        \centering
        \includegraphics[width = 0.7\textwidth]{gerber_top.jpg}
        \caption{Widok pliku gerber warstwy 1 }
        \label{fig:gerber_top}
    \end{figure}

    \begin{figure}[H]
        \centering
        \includegraphics[width = 0.7\textwidth]{gerber_bottom.jpg}
        \caption{Widok pliku gerber warstwy 4 }
        \label{fig:gerber_bottom}
    \end{figure}


\subsection{Symulacje filtrów wejściowych}
Poniżej przedstawiono schematy symulacyjne oraz charakterystyki filtrów wejściowych sekcji analogowej.
Dla układu ADS1115 o częstotliwości próbkowania $860Hz$ zaprojektowano filtr RC pierwszego rzędu o częstotliwość odcięcia $250Hz$ oraz $20dB$ spadku na dekadę.
W przypadku PICO sytuacja była podobna, lecz tutaj częstotliwość próbkowania wynosiła $500kHz$.
W tej sytuacji użyto filtru RC drugiego rzędu o częstotliwości odcięcia około $115kHz$ i $40dB$ spadku na dekadę.


\begin{figure}[H]
        \centering
        \includegraphics[width = 0.7\textwidth]{filter_ADS1115_simulation.jpg}
        \caption{Układ symulacyjny filtru antyaliasingowego ADS1115}
        \label{fig:gerber_bottom}
    \end{figure}

    \begin{figure}[H]
        \centering
        \includegraphics[width = 0.7\textwidth]{filter_PICO_simulation.jpg}
        \caption{Układ symulacyjny filtru antyaliasingowego PICO}
        \label{fig:gerber_bottom}
    \end{figure}


\begin{figure}[!ht]
    \centering
    \begin{tikzpicture}
        \begin{axis}[
            width = 0.45\textwidth,
            grid = both,
            % axis lines= middle,
            % axis line style={->},
            xmin = 1, xmax = 10e3,
            xmode=log,
            title= Filtr ADS1115,
            ylabel = wzmocnienie ${[dB]}$,
            xlabel = częstotliwość ${[log(Hz)]}$
        ]
            \addplot table [x = freq, y =voltage, col sep = comma]{Measure/filter_ADS1115.csv};
            % \addplot table [x = duty, y = speedL, col sep = comma]{Measure/speed.csv};
        \end{axis}
    \end{tikzpicture}
    \begin{tikzpicture}
        \begin{axis}[
            width = 0.45\textwidth,
            grid = both,
            % axis lines= middle,
            % axis line style={->},
            xmin = 1e4, xmax = 3e6,
            xmode=log,
            title= Filtr PICO,
            ylabel = wzmocnienie ${[dB]}$,
            xlabel = częstotliwość ${[log(Hz)]}$
        ]
            \addplot table [x = freq, y =voltage, col sep = comma]{Measure/filter_PICO.csv};
            % \addplot table [x = duty, y = speedL, col sep = comma]{Measure/speed.csv};
        \end{axis}
    \end{tikzpicture}
    \caption{Wykresy tłumienia filtrów wejściowych}
\end{figure}